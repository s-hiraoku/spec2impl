---
name: harness-guide-generator
description: Generate HARNESS_GUIDE.md with usage instructions for all downloaded components. Creates a comprehensive guide for users to start using the implementation harness.
tools: Read, Write, Glob, Grep
---

# Harness Guide Generator

Generate a comprehensive guide (`docs/HARNESS_GUIDE.md`) for the implementation harness created by spec2impl.

## Input

- **expandedTechStack**: Tech stack from Step 2 (original, implicit, userSelected, confirmed)
- **downloadedItems**: All downloaded components from Steps 3-7
- **specDirectory**: Original specification directory
- **taskCount**: Number of tasks in docs/TASKS.md

## Execution Flow

### Phase 1: Scan Downloaded Components

```typescript
// Scan .claude/ directory for downloaded components
const skills = Glob(".claude/skills/*/SKILL.md")  // Exclude spec2impl/
const agents = Glob(".claude/agents/*.md")        // Exclude spec2impl/
const commands = Glob(".claude/commands/*.md")    // Exclude spec2impl.md

// Read .mcp.json for MCP configurations
const mcpConfig = Read(".mcp.json")

// Read .claude/settings.local.json for settings
const settings = Read(".claude/settings.local.json")
```

### Phase 2: Extract Component Information

For each component, extract from YAML frontmatter:
- `name`: Component name
- `description`: What it does

```typescript
// Example: Extract from agent file
const content = Read(".claude/agents/typescript-pro.md")
// Parse YAML frontmatter between --- markers
// Extract: name, description
```

### Phase 3: Extract Token Requirements from MCPs

Parse `.mcp.json` to identify required tokens:

```typescript
// Common token patterns
const tokenPatterns = {
  "postgres": { env: "DATABASE_URL", format: "postgresql://user:pass@host:5432/db" },
  "github": { env: "GITHUB_TOKEN", format: "ghp_..." },
  "slack": { env: "SLACK_TOKEN", format: "xoxb-..." },
  "stripe": { env: "STRIPE_API_KEY", format: "sk_..." },
  "brave-search": { env: "BRAVE_API_KEY", format: "BSA..." }
}
```

### Phase 4: Extract First Tasks from TASKS.md

```typescript
const tasksContent = Read("docs/TASKS.md")
// Extract first 3 tasks with their IDs, titles, and dependencies
```

### Phase 5: Generate HARNESS_GUIDE.md

Write to `docs/HARNESS_GUIDE.md`:

```markdown
# ğŸš€ Implementation Harness Guide

This guide describes the implementation environment generated by spec2impl for this project.

## ğŸ“‹ Generation Summary

| Item | Content |
|------|---------|
| Generated | {timestamp} |
| Spec Directory | {specDirectory} |
| Task Count | {taskCount} |

### Tech Stack

| Category | Technologies |
|----------|--------------|
| Original | {originalTechStack} |
| Implicit Dependencies | {implicitDependencies} |
| User Selected | {userSelected} |

---

## ğŸ› ï¸ Downloaded Components

### Skills ({count})

| Skill | Description | Usage |
|-------|-------------|-------|
| {name} | {description} | This skill is applied automatically |

### Agents ({count})

| Agent | Description | How to Use |
|-------|-------------|------------|
| {name} | {description} | `Use the {name} agent to ...` |

### Commands ({count})

| Command | Description | How to Run |
|---------|-------------|------------|
| {name} | {description} | `/{name} [args]` |

### MCPs ({count})

| MCP | Description | Required Token |
|-----|-------------|----------------|
| {name} | {description} | `{tokenEnvVar}` |

---

## ğŸ”‘ Token Configuration

Configure the following tokens:

### {tokenName}
- **Environment Variable**: `{envVar}`
- **Format**: `{format}`
- **Get From**: {getFrom}

---

## ğŸ“ Task List

See `docs/TASKS.md` for the full list.

### First 3 Tasks

- [ ] **{taskId}**: {taskTitle}
  - Dependencies: {depends}

---

## ğŸš¦ Getting Started

1. **Configure tokens** (if required)
   ```bash
   export GITHUB_TOKEN=ghp_...
   export DATABASE_URL=postgresql://...
   ```

2. **Start the first task**
   ```
   "Implement {firstTaskId}"
   ```

3. **Check progress**
   ```
   "Show task progress"
   ```

4. **Use agents**
   ```
   "Use the {agentName} agent to help with ..."
   ```

5. **Run commands**
   ```
   /{commandName} [args]
   ```

---

## ğŸ“š Reference

| File | Description |
|------|-------------|
| `docs/TASKS.md` | Implementation task list |
| `CLAUDE.md` | Project configuration |
| `.mcp.json` | MCP server configuration |
| `.claude/settings.local.json` | Claude settings |
| `.claude/skills/` | Downloaded skills |
| `.claude/agents/` | Downloaded agents |
| `.claude/commands/` | Downloaded commands |

---

## ğŸ’¡ Tips

- **Automatic Agent Selection**: Claude automatically selects the appropriate agent based on task content
- **Automatic Skill Application**: Downloaded skills are automatically applied during conversations
- **Progress Visualization**: Use `progress-dashboard` to visually check implementation progress

---

*This guide was automatically generated by spec2impl*
```

## Output Format

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Harness Guide Generated
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Output: docs/HARNESS_GUIDE.md

Contents:
  ğŸ“‹ Generation Summary
  ğŸ› ï¸ Components: {skillCount} skills, {agentCount} agents, {commandCount} commands, {mcpCount} MCPs
  ğŸ”‘ Token Requirements: {tokenCount} tokens to configure
  ğŸ“ First 3 Tasks listed
  ğŸš¦ Quick Start Guide

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

## Important Notes

1. **Exclude spec2impl components** - Don't list spec2impl's own agents/skills/commands
2. **Only list user-facing components** - Components that the user will actually use
3. **Provide actionable instructions** - How to call agents, run commands, configure tokens
4. **Clear headers** - Use clear section headers for better readability
